!function(){"use strict";var t,e,n,r,o=(null===(t=document.currentScript)||void 0===t?void 0:t.getAttribute("data-env"))||"default",i=(n="martechEnv",new URL(window.location.href).searchParams.get(n)||(null===(e=window.localStorage)||void 0===e?void 0:e.getItem("martech_env"))||"default"),a=function(){function PrivateVars(){this.map=new WeakMap}return PrivateVars.prototype.create=function(t,e){return this.map.set(t,e),e},PrivateVars.prototype.extend=function(){return this},PrivateVars.prototype.merge=function(t,e){var n=this.map.get(t),r=Object.assign({},n,e);return this.map.set(t,r),r},PrivateVars.prototype.get=function(t){return this.map.get(t)},PrivateVars.prototype.delete=function(t){return this.map.delete(t)},PrivateVars}(),__awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},__generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(s){return function(c){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},__spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},s=function(){function Queue(){this.pendingItems=[],this.processedItems=[],this.processing=!1}return Queue.prototype.add=function(t){this.pendingItems.push(t),this._next()},Queue.prototype.setHandler=function(t){this.handler=t},Queue.prototype._next=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(n){switch(n.label){case 0:return null==this.handler?[2]:(t=this.handler,0===this.pendingItems.length||this.processing?[2]:(this.processing=!0,e=this.pendingItems.shift(),[4,new Promise((function(n){t(e,n)}))]));case 1:return n.sent(),this.processedItems.push(e),this.processing=!1,this._next(),[2]}}))}))},Queue.prototype.run=function(){this._next()},Queue.prototype.getPendingItems=function(){return __spreadArray([],this.pendingItems,!0)},Queue.prototype.getProcessedItems=function(){return __spreadArray([],this.processedItems,!0)},Queue}(),c=s,u=function(){function SlimEventEmitter(){this._events=new Map}return SlimEventEmitter.prototype.on=function(t,e,n){void 0===n&&(n=!1),this._events.has(t)||this._events.set(t,[]),this._events.get(t).push({callback:e,once:n})},SlimEventEmitter.prototype.once=function(t,e){this.on(t,e,!0)},SlimEventEmitter.prototype.off=function(t,e){var n=this._events.get(t);null!=n&&(0===(n=n.filter((function(t){return t.callback!==e}))).length?this._events.delete(t):this._events.set(t,n))},SlimEventEmitter.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this._events.get(t);if(null!=r)for(var o=0,i=r;o<i.length;o++){var a=i[o];"function"==typeof a.callback&&a.callback.apply(a,e),a.once&&this.off(t,a.callback)}},SlimEventEmitter}(),l=u,p=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),Logger_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},f=["debug","info","warn","error"],h=function(t){function Logger(e,n){var r=t.call(this)||this;return r._messages=[],r._children=[],r._prefix="",r._namespace=e,r._levels=n,r}return p(Logger,t),Logger.create=function(t,e){return void 0===e&&(e=Logger_spreadArray([],f,!0)),new Logger([t],e)},Logger.prototype.setPrefix=function(t){this._prefix=t},Logger.prototype.getMessages=function(){return this._messages},Logger.prototype.getNamespace=function(){return 0==this._namespace.length?null:this._namespace[this._namespace.length-1]},Logger.prototype.getNiceNamespace=function(t){return void 0===t&&(t=":"),0==this._namespace.length?null:1==this._namespace.length?this._namespace[0]:this._namespace.slice(1).join(t)},Logger.prototype.getChildren=function(){return this._children},Logger.prototype.getAllLogger=function(){var t=[];return this._children.forEach((function(e){t.push.apply(t,e.getAllLogger())})),t.push(this),t},Logger.prototype.setLogLevels=function(t){var e;(e=this._levels).splice.apply(e,Logger_spreadArray([0,this._levels.length],t,!1))},Logger.prototype.extend=function(t,e){var n=this;void 0===e&&(e=this._levels);var r=this._children.find((function(e){return e.getNamespace()==t}));return null==r&&((r=new Logger(Logger_spreadArray(Logger_spreadArray([],this._namespace,!0),[t],!1),e)).setPrefix(this._prefix),this._children.push(r),this.emit("logger",r),this.emit("logger:all",this,r),r.on("message:all",(function(t,e){n.emit("message:all",t,e)})),r.on("logger:all",(function(t,e){n.emit("logger:all",t,e)}))),r},Logger.prototype.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._log.apply(this,Logger_spreadArray(["debug",t],e,!1))},Logger.prototype.info=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._log.apply(this,Logger_spreadArray(["info",t],e,!1))},Logger.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._log.apply(this,Logger_spreadArray(["warn",t],e,!1))},Logger.prototype.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._log.apply(this,Logger_spreadArray(["error",t],e,!1))},Logger.prototype.log=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t=t.toLowerCase(),t=f.includes(t)?t:"debug",this._log.apply(this,Logger_spreadArray([t,e],n,!1))},Logger.prototype._log=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o={level:t,message:e,args:n,time:performance.now()};if(this._messages.push(o),this.emit("message",o),this.emit("message:all",this,o),this._levels.includes(t)){var i=this.getNiceNamespace();"string"==typeof e?console[t].apply(console,Logger_spreadArray(["".concat(this._prefix,"[").concat(i,"] ").concat(e)],n,!1)):console[t].apply(console,Logger_spreadArray(["".concat(this._prefix,"[").concat(i,"]"),e],n,!1))}},Logger}(l),g=h.create("Manager",[]);g.setPrefix("[MartechAgents]");var __assign=function(){return __assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},__assign.apply(this,arguments)},MartechAgent_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},y=new a,PV=function(t){return y.get(t)},d=g.extend("Agent"),_=function(){function MartechAgent(t,e){var n=this.constructor,r=this;if(this.name="",this.status="pending",n===MartechAgent){var o=new v(t,e);this.name=o.name,this.status=o.status,o.emitter.on("statuschange",(function(t){r.status=t})),y.create(this,o)}}return MartechAgent.prototype.getName=function(){return PV(this).name},MartechAgent.prototype.getStatus=function(){return PV(this).status},MartechAgent.prototype.subscribe=function(t){return PV(this).subscribe(t)},MartechAgent.prototype.subscribeOnce=function(t){return PV(this).subscribeOnce(t)},MartechAgent.prototype.unsubscribe=function(t){PV(this).unsubscribe(t)},MartechAgent.prototype.log=function(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];(n=PV(this).log).log.apply(n,MartechAgent_spreadArray([t,e],r,!1))},MartechAgent.prototype.getRuntime=function(){return PV(this).manager.getRuntime()},MartechAgent.prototype.setReadyState=function(){PV(this).setReadyState()},MartechAgent.prototype.getStartupDuration=function(){return PV(this).getStartupDuration()},MartechAgent}(),v=function(){function MartechAgentInternal(t,e){this.status="disabled",this.emitter=new l,this.scenarioConfig={},this.timing_loadStart=null,this.timing_loadEnd=null,this.name=t.getName(),this.snippet=t,this.manager=e,this.log=d.extend(this.name)}return MartechAgentInternal.prototype.setStatus=function(t){this.status=t,this.log.info("status changed to '%s'",this.status),this.emitter.emit("statuschange",t)},MartechAgentInternal.prototype.getConfig=function(t){return void 0===t&&(t={}),__assign(__assign({},t),this.scenarioConfig)},MartechAgentInternal.prototype.start=function(t,e){var n=this;return void 0===t&&(t={}),void 0===e&&(e=5e3),new Promise((function(r){var o=!1;switch(n.status){case"timeout":case"disabled":case"pending":n.scenarioConfig=t,n.timing_loadStart=performance.now(),n.timing_loadEnd=null,n.setStatus("loading");var i=void 0;e>0&&(i=setTimeout((function(){n.setStatus("timeout")}),e)),n.subscribeOnce((function(t){clearTimeout(i)})),o=!0;break;case"loading":var a=n.subscribe((function(t){"loaded"===t?(n.unsubscribe(a),r(!0)):"timeout"===n.status&&(n.unsubscribe(a),r(!1))}));break;case"loaded":r(!0);break;default:r(!1)}o&&n.snippet.inject()}))},MartechAgentInternal.prototype.subscribe=function(t){return this.emitter.on("statuschange",t),t},MartechAgentInternal.prototype.subscribeOnce=function(t){return this.emitter.once("statuschange",t),t},MartechAgentInternal.prototype.unsubscribe=function(t){this.emitter.off("statuschange",t)},MartechAgentInternal.prototype.setReadyState=function(){"loaded"!==this.status&&(this.timing_loadEnd=performance.now(),this.setStatus("loaded"))},MartechAgentInternal.prototype.getStartupDuration=function(){return null!=this.timing_loadStart&&null!=this.timing_loadEnd?this.timing_loadEnd-this.timing_loadStart:null},MartechAgentInternal}(),m=["string","number","boolean","array","function","null","any"],MartechVariable_assign=function(){return MartechVariable_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},MartechVariable_assign.apply(this,arguments)},b=function(){function MartechVariable(t,e,n,r){this._value=void 0,this._defaultValue=void 0,this._preprocessor=function(t){return t},this._emitter=new l,this._name=t,this._options=MartechVariable_assign({type:"any",allowTypeParsing:!0,nullable:!1,triggerAlways:!1},r),m.includes(this._options.type||"any")||(E.warn("[%s] Unknown type '%s', falling back to 'any'.",this._name,this._options.type),this._options.type="any"),"null"===this._options.type&&(this._options.nullable=!0),this._defaultValue=this._parseValue(n),"function"==typeof e?this._preprocessor=e:this._value=this._parseValue(e)}return MartechVariable.prototype._parseValue=function(t){var e=this._options.type||"any",n=this._options.nullable||!1,r=this._options.allowTypeParsing||!1;if(void 0!==t){if(null===t)return n?null:void E.warn("[%s] Value %o is not allowed for this variable, falling back to default value.",this._name,null);if(!hasType(t,e)){if(!r)return void E.warn("[%s] Parsing value %o to type '%s' is disabled, falling back to default value.",this._name,t,e);var o=parseType(t,e);return void 0===o?void E.warn("[%s] Could not parse value %o to type '%s', falling back to default value.",this._name,t,e):o}return t}},MartechVariable.prototype.getName=function(){return this._name},MartechVariable.prototype.getValue=function(){return void 0===this._value?this._defaultValue:this._value},MartechVariable.prototype.setValue=function(t){t=this._preprocessor(t),t=this._parseValue(t),(this._options.triggerAlways||t!==this._value)&&(this._value=t,this._emitter.emit("change",this.getValue()))},MartechVariable.prototype.subscribe=function(t){return this._emitter.on("change",t),t},MartechVariable.prototype.subscribeOnce=function(t){return this._emitter.once("change",t),t},MartechVariable.prototype.unsubscribe=function(t){return this._emitter.off("change",t),t},MartechVariable}(),hasType=function(t,e){switch(e){case"any":return!0;case"string":return"string"==typeof t;case"number":return"number"==typeof t;case"boolean":return"boolean"==typeof t;case"array":return Array.isArray(t);case"function":return"function"==typeof t;case"null":return null===t}},parseType=function(t,e){switch(e){case"any":return t;case"string":if("string"==typeof t)return t;if("object"==typeof t)return;return String(t).toString();case"number":if("number"==typeof t)return t;var n=parseFloat(t);return Number.isNaN(n)?void 0:n;case"boolean":return"boolean"==typeof t?t:"string"==typeof t?"true"==t.toLowerCase():"number"==typeof t?0!==t:void 0;case"array":return Array.isArray(t)?t:void 0;case"function":return"function"==typeof t?t:void 0;case"null":return null;default:return}},M=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),w=function(t){function MartechVariableNormal(e,n,r,o){return t.call(this,e,n,r,o)||this}return M(MartechVariableNormal,t),MartechVariableNormal}(b),A=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),DataLayerWrapper_assign=function(){return DataLayerWrapper_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},DataLayerWrapper_assign.apply(this,arguments)},DataLayerWrapper_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},k=function(t){function DataLayerWrapper(){var e=t.call(this)||this;e._processedObjects=[],e._computedVars={},window.dataLayer=window.dataLayer||[];var n=window.dataLayer.push.bind(window.dataLayer);return window.dataLayer.push=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=n.apply(void 0,t);return setTimeout((function(){e.update()}),0),o},e.update(),e}return A(DataLayerWrapper,t),DataLayerWrapper.prototype.get=function(t,e){var n;return null==e?this._computedVars[t]:null===(n=DataLayerWrapper_spreadArray([],window.dataLayer,!0).reverse().filter((function(e){return Object.keys(e).includes(t)})).find(e))||void 0===n?void 0:n[t]},DataLayerWrapper.prototype.getAll=function(){return DataLayerWrapper_assign({},this._computedVars)},DataLayerWrapper.prototype.getLatest=function(){return this._processedObjects[this._processedObjects.length-1]},DataLayerWrapper.prototype.update=function(){for(var t=0,e=window.dataLayer;t<e.length;t++){var n=e[t];if(!this._processedObjects.includes(n)&&"object"==typeof n){this._processedObjects.push(n);var r=this._computedVars,o=DataLayerWrapper_assign(DataLayerWrapper_assign({},this._computedVars),n);for(var i in this._computedVars=o,this.emit("push",n),o)o[i]!==r[i]&&this.emit("change",{key:i,value:o[i],ref:n})}}},DataLayerWrapper}(l),I=new k,O=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),R=function(t){function MartechVariableDatalayer(e,n,r,o){var i=t.call(this,e,n,r,o)||this;return null==i._options.searchName&&(i._options.searchName=i._name),"function"!=typeof i._options.filter&&(i._options.filter=void 0),i._dataLayerValue=I.get(i._options.searchName,i._options.filter),i.setValue(i._dataLayerValue),i._options.triggerAlways?I.on("push",(function(t){(null==i._options.filter||i._options.filter(t))&&null!=i._options.searchName&&Object(t).hasOwnProperty(i._options.searchName)&&(i._dataLayerValue=t[i._options.searchName],i.setValue(i._dataLayerValue))})):I.on("change",(function(t){if(t.key===i._options.searchName){if(null!=i._options.filter&&!i._options.filter(t.ref))return;i._dataLayerValue=t.value,i.setValue(i._dataLayerValue)}})),i}return O(MartechVariableDatalayer,t),MartechVariableDatalayer}(b),S=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),j=function(t){function MartechVariableInterval(e,n,r,o){var i=this;return"function"!=typeof n&&(E.error("[%s] Error: Value of an interval variable must be a function.",e,n),n=function(){}),i=t.call(this,e,n,r,o)||this,Number.isInteger(i._options.interval)&&setInterval((function(){i.setValue(void 0)}),i._options.interval),i.setValue(void 0),i}return S(MartechVariableInterval,t),MartechVariableInterval}(b),x=new a,MartechRuntime_PV=function(t){return x.get(t)},E=g.extend("Runtime"),V=function(){function MartechRuntime(){this.constructor===MartechRuntime&&x.create(this,new L)}return MartechRuntime.prototype.add=function(t){return MartechRuntime_PV(this).add(t)},MartechRuntime.prototype.exists=function(t){return MartechRuntime_PV(this).exists(t)},MartechRuntime.prototype.get=function(t){return MartechRuntime_PV(this).get(t)},MartechRuntime.prototype.getMany=function(t){return MartechRuntime_PV(this).getMany(t)},MartechRuntime.prototype.set=function(t,e){return MartechRuntime_PV(this).set(t,e)},MartechRuntime.prototype.subscribe=function(t,e){return MartechRuntime_PV(this).subscribe(t,e)},MartechRuntime.prototype.subscribeOnce=function(t,e){return MartechRuntime_PV(this).subscribeOnce(t,e)},MartechRuntime.prototype.unsubscribe=function(t,e){return MartechRuntime_PV(this).unsubscribe(t,e)},MartechRuntime.prototype.list=function(){return MartechRuntime_PV(this).list()},MartechRuntime.prototype.raw=function(){return MartechRuntime_PV(this).raw()},MartechRuntime.prototype.getDataLayer=function(){return I.getAll()},MartechRuntime.prototype.getLatestDataLayer=function(){return I.getLatest()},MartechRuntime}(),L=function(){function MartechRuntimeInternal(){this.emitter=new l,this.variables=[]}return MartechRuntimeInternal.prototype._create=function(t,e,n,r,o){switch(r){case"normal":return new w(t,e,n,o);case"datalayer":return new R(t,e,n,o);case"interval":return new j(t,e,n,o);default:return}},MartechRuntimeInternal.prototype.add=function(t){var e=this;if("object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;if("object"!=typeof t.options&&(t.options={}),"string"!=typeof t.mode){var n=t.options;"string"==typeof n.mode?t.mode=n.mode:t.mode="normal"}if(this.exists(t.name))return!1;var r=this._create(t.name,t.value,t.defaultValue,t.mode,t.options);return null!=r&&(this.variables.push(r),r.subscribe((function(t){e.emitter.emit("change"),e.emitter.emit("change:".concat(r.getName()),t)})),this.emitter.emit("change"),this.emitter.emit("change:".concat(r.getName()),r.getValue()),!0)},MartechRuntimeInternal.prototype.exists=function(t){return null!=this._get(t)},MartechRuntimeInternal.prototype._get=function(t){return this.variables.find((function(e){return e.getName()===t}))},MartechRuntimeInternal.prototype.get=function(t){var e;return null===(e=this._get(t))||void 0===e?void 0:e.getValue()},MartechRuntimeInternal.prototype.getMany=function(t){for(var e,n={},r=0,o=t;r<o.length;r++){var i=o[r];n[i]=null===(e=this._get(i))||void 0===e?void 0:e.getValue()}return n},MartechRuntimeInternal.prototype.set=function(t,e){var n;this.exists(t)?null===(n=this._get(t))||void 0===n||n.setValue(e):this.add({name:t,value:e,mode:"normal"})},MartechRuntimeInternal.prototype.subscribe=function(t,e){return this.emitter.on("change:".concat(t),e),e},MartechRuntimeInternal.prototype.subscribeOnce=function(t,e){return this.emitter.once("change:".concat(t),e),e},MartechRuntimeInternal.prototype.unsubscribe=function(t,e){return this.emitter.off("change:".concat(t),e),e},MartechRuntimeInternal.prototype.list=function(){return this.variables.map((function(t){return t.getName()}))},MartechRuntimeInternal.prototype.raw=function(){for(var t={},e=0,n=this.variables;e<n.length;e++){var r=n[e];t[r.getName()]=r.getValue()}return t},MartechRuntimeInternal}(),P=function(){function MartechHook(t,e){this.id=MartechHook.nextId++,this.callback=t,this.persist=e}return MartechHook.add=function(t,e){void 0===e&&(e=!1);var n=new MartechHook(t,e);return MartechHook.list.push(n),n},MartechHook.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=MartechHook.list.find((function(e){return e.getId()===t}));if(null!=r)return r.call.apply(r,e)},MartechHook.prototype.getId=function(){return this.id},MartechHook.prototype.call=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.callback.apply(this,t);return this.persist||this.remove(),n},MartechHook.prototype.remove=function(){var t=MartechHook.list.indexOf(this);t>=0&&MartechHook.list.splice(t,1)},MartechHook.list=[],MartechHook.nextId=Date.now(),MartechHook}(),C=function(){function MartechSnippet(t,e,n){this.type="unknown",this.name=t,this.scripts=e,this.manager=n}return MartechSnippet.prototype.getName=function(){return this.name},MartechSnippet.prototype.getType=function(){return this.type},MartechSnippet.prototype.inject=function(){for(var t=0;t<this.scripts.length;t++){var e=this.scripts[t],n=document.createElement("script");if(n.dataset.tagName=this.name,n.dataset.tagType=this.type,n.dataset.tagIdx=String(t).toString(),null!=e.src)n.src=e.src,n.async=e.async||!1,n.defer=e.defer||!1;else if(null!=e.content){var r=this.addHooks(e.content);if(null==r)continue;n.textContent="(function(__MAM__){".concat(r,"})(window.MartechAgentsManager)")}document.head.appendChild(n)}},MartechSnippet.prototype.addHooks=function(t){return t},MartechSnippet.prototype.export=function(){return{name:this.name,type:this.type,scripts:this.scripts}},MartechSnippet}(),N=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),MartechSnippetAgent_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},T=function(t){function MartechSnippetAgent(e,n,r){var o=t.call(this,e,n,r)||this;return o.type="agent",o}return N(MartechSnippetAgent,t),MartechSnippetAgent.prototype.addHooks=function(t){var e=this,n=this.manager.getAgent(this.getName());if(null==n)return null;var r=y.get(n),o=P.add((function(t){return null!=t?(n.log("warn","You have called MARTECH_AGENT() with a parameter. This is deprecated and will be removed in the future. Please use MARTECH_AGENT_INIT() instead."),r.getConfig(t)):n})),i=P.add((function(t){return r.getConfig(t)})),a=P.add((function(){return e.manager.getRuntime()}),!0),s=P.add((function(){return n.setReadyState()})),c=P.add((function(t,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return n.log.apply(n,MartechSnippetAgent_spreadArray([t,e],r,!1))}),!0);return t=(t=(t=(t=(t=(t=t.replace(new RegExp("MARTECH_AGENT_INIT\\(","g"),"__MAM__._hook(".concat(i.getId(),","))).replace(new RegExp("MARTECH_AGENT_READY(\\(\\))?","g"),"__MAM__._hook(".concat(s.getId(),")"))).replace(new RegExp("MARTECH_RUNTIME(\\(\\))?","g"),"__MAM__._hook(".concat(a.getId(),")"))).replace(new RegExp("MARTECH_LOG\\(","g"),"__MAM__._hook(".concat(c.getId(),","))).replace(new RegExp("MARTECH_AGENT\\(","g"),"__MAM__._hook(".concat(o.getId(),","))).replace(new RegExp("MARTECH_AGENT(\\(\\))?","g"),"__MAM__._hook(".concat(o.getId(),")")),t="try{".concat(t,"}catch(e){__MAM__._hook(").concat(c.getId(),", 'error', e)}")},MartechSnippetAgent}(C),H=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),MartechSnippetRuntime_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},D=function(t){function MartechSnippetRuntime(e,n,r){var o=t.call(this,e,n,r)||this;return o.type="runtime",o}return H(MartechSnippetRuntime,t),MartechSnippetRuntime.prototype.addHooks=function(t){var e=this,n=P.add((function(t){return e.manager.getRuntime().add(t)}),!0),r=P.add((function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return E.log.apply(E,MartechSnippetRuntime_spreadArray([t,e],n,!1))}),!0);return t=(t=t.replace(new RegExp("MARTECH_VAR\\(","g"),"__MAM__._hook(".concat(n.getId(),","))).replace(new RegExp("MARTECH_LOG\\(","g"),"__MAM__._hook(".concat(r.getId(),","))},MartechSnippetRuntime}(C),G=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),MartechSnippetScenario_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},Q=function(t){function MartechSnippetScenario(e,n,r){var o=t.call(this,e,n,r)||this;return o.type="scenario",o}return G(MartechSnippetScenario,t),MartechSnippetScenario.prototype.addHooks=function(t){var e=z.get(this.manager),n=P.add((function(t){e.run(t)})),r=P.add((function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return g.log.apply(g,MartechSnippetScenario_spreadArray([t,e],n,!1))}),!0);return t=(t=t.replace(new RegExp("MARTECH_INIT\\(","g"),"__MAM__._hook(".concat(n.getId(),","))).replace(new RegExp("MARTECH_LOG\\(","g"),"__MAM__._hook(".concat(r.getId(),","))},MartechSnippetScenario}(C),MartechAdapter_assign=function(){return MartechAdapter_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},MartechAdapter_assign.apply(this,arguments)},MartechAdapter_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},MartechAdapter_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(s){return function(c){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},W=(g.extend("Adapter"),function(){function MartechAdapter(t){this.runtimes=[],this.agents=[],this.manager=t}return MartechAdapter.prototype.configure=function(t){return MartechAdapter_awaiter(this,void 0,void 0,(function(){var e,n,r=this;return MartechAdapter_generator(this,(function(o){switch(o.label){case 0:return null==(t=MartechAdapter_assign({},t)).configFromUrl?[3,3]:[4,fetch(t.configFromUrl)];case 1:return(e=o.sent()).ok?(n=t,[4,e.json()]):[3,3];case 2:n.config=o.sent(),o.label=3;case 3:return null!=t.config?(null!=t.config.scenario&&(this.scenario=new Q(t.config.scenario.name,t.config.scenario.scripts,this.manager)),null!=t.config.runtimes&&(this.runtimes=t.config.runtimes.map((function(t){return new D(t.name,t.scripts,r.manager)}))),null!=t.config.agents&&(this.agents=t.config.agents.map((function(t){return new T(t.name,t.scripts,r.manager)}))),[2,!0]):[2,!1]}}))}))},MartechAdapter.prototype.getScenario=function(){return this.scenario},MartechAdapter.prototype.getAgents=function(){return this.agents},MartechAdapter.prototype.getRuntimes=function(){return this.runtimes},MartechAdapter}()),MartechAgentsManager_assign=function(){return MartechAgentsManager_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},MartechAgentsManager_assign.apply(this,arguments)},MartechAgentsManager_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},MartechAgentsManager_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(s){return function(c){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},MartechAgentsManager_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},z=new a,MartechAgentsManager_PV=function(t){return z.get(t)},F=function(){function MartechAgentsManager(){var t=this.constructor;this.version="v2.0.3",this.build_date="2024-06-07T14:23:08.792Z",this.build_env="production",this.env=o,t===MartechAgentsManager&&z.create(this,new U(this))}return MartechAgentsManager.prototype.getAgents=function(){return MartechAgentsManager_PV(this).getAgents()},MartechAgentsManager.prototype.getAgent=function(t){return MartechAgentsManager_PV(this).getAgent(t)},MartechAgentsManager.prototype.getRuntime=function(){return MartechAgentsManager_PV(this).runtime},MartechAgentsManager.prototype._hook=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return P.call.apply(P,MartechAgentsManager_spreadArray([t],e,!1))},MartechAgentsManager.prototype.push=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=MartechAgentsManager_PV(this)).push.apply(t,e)},MartechAgentsManager.prototype.isConfigured=function(){return MartechAgentsManager_PV(this).isConfigured},MartechAgentsManager.prototype.currentEnv=function(){return o},MartechAgentsManager}(),U=function(){function MartechAgentsManagerInternal(t){var e=this;this.agents=[],this.runtime=new V,this.queue=new c,this.callbacks=new c,this.configs=[],this.isConfigured=!1,this.isInitialized=!1,this.isRunning=!1,this.log=g,this.MartechAgentClass=_,this.manager=t,this.adapter=new W(t),this.queue.setHandler((function(t,n){return MartechAgentsManager_awaiter(e,void 0,void 0,(function(){var e;return MartechAgentsManager_generator(this,(function(r){switch(r.label){case 0:return null==t?[2,n()]:"function"==typeof t?(this.callbacks.add(t),this.isInitialized&&this.callbacks.run(),[2,n()]):"object"!=typeof t?[2,n()]:(this.configs.push(MartechAgentsManager_assign({env:"default"},t)),this.isConfigured||null==(e=this._resolveConfig(this.configs,o))?[2,n()]:[4,this.adapter.configure(e)]);case 1:return r.sent()&&(this.isConfigured=!0,this.init()),n(),[2]}}))}))})),this.callbacks.setHandler((function(t,n){try{t(e.manager)}catch(t){console.error(t)}n()}))}return MartechAgentsManagerInternal.prototype.getAgents=function(){return MartechAgentsManager_spreadArray([],this.agents,!0)},MartechAgentsManagerInternal.prototype.getAgent=function(t){return this.agents.find((function(e){return e.getName()===t}))},MartechAgentsManagerInternal.prototype._resolveConfig=function(t,e){var n=t.find((function(t){return t.env===e}));if(null!=n)return null!=n.configFromEnv?this._resolveConfig(t.filter((function(t){return t!=n})),n.configFromEnv):n},MartechAgentsManagerInternal.prototype.init=function(){if(!this.isInitialized){this.isInitialized=!0,g.info("Create agents from adapter data ...");for(var t=0,e=this.adapter.getAgents();t<e.length;t++){var n=e[t],r=new this.MartechAgentClass(n,this.manager);this.agents.push(r)}this.callbacks.run(),g.debug("Injecting runtime snippet ...");for(var o=0,i=this.adapter.getRuntimes();o<i.length;o++){i[o].inject()}g.debug("Injecting scenario snippet ...");var a=this.adapter.getScenario();null!=a?a.inject():g.error("Adapter does not provide a scenario snippet. Nothing will be injected.")}},MartechAgentsManagerInternal.prototype.run=function(t){var e=this;if(!this.isRunning){this.isRunning=!0,g.debug("Agent initialization started ...");var n="Provided init config is invalid: ";if(null!=t&&"object"==typeof t)if(null!=t.agents&&Array.isArray(t.agents)){for(var r=[],o=0,i=t.agents;o<i.length;o++){if("object"==typeof(l=i[o]))if(null!=l.name)if(l.enable){var a=this.getAgent(l.name);if(null!=a){y.get(a).setStatus("pending");var s={name:l.name,enable:!!l.enable,config:{},options:{timeout:5e3,loadAfter:[]}};"object"==typeof l.config&&(s.config=l.config),"object"==typeof l.options&&("number"==typeof l.options.timeout&&(s.options.timeout=l.options.timeout),"string"==typeof l.options.loadAfter?s.options.loadAfter=[l.options.loadAfter]:Array.isArray(l.options.loadAfter)&&(s.options.loadAfter=l.options.loadAfter)),r.push(s)}else g.warn(n+'Agent "'.concat(l.name,'" is not available and will be skipped.'))}else g.warn('Agent "'.concat(l.name,'" is disabled and will be skipped.'));else g.warn(n+"Agent does not have a name and will be skipped.");else g.warn(n+"Agent has to be defined as object. Agent will be skipped.")}for(var worker=function(){for(var t=e.agents.filter((function(t){return"pending"===t.getStatus()})),_loop_2=function(t){var n=r.find((function(e){return e.name===t.getName()}));if(null==n)return"continue";for(var o=n.options.loadAfter,i=!0,a=0;a<o.length&&i;a++){var s=o[a],c=!1;"*"==s[s.length-1]&&(s=s.slice(0,-1),c=!0);var u=e.getAgent(s);null!=u?c?"loaded"!==u.getStatus()&&(i=!1):["loaded","timeout"].includes(u.getStatus())||(i=!1):i=!1}i&&y.get(t).start(n.config,n.options.timeout)},n=0,o=t;n<o.length;n++){_loop_2(o[n])}0===t.length&&g.debug("Agent initialization finished.")},_loop_1=function(t){var e=t.subscribe((function(n){"loaded"==n&&t.unsubscribe(e),["loaded","timeout"].includes(n)&&worker()}))},c=0,u=this.agents;c<u.length;c++){var l;_loop_1(l=u[c])}worker()}else g.error(n+'Property "agents" must be an array.');else g.error(n+"Config has to be an object.")}},MartechAgentsManagerInternal.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var o=r[n];this.queue.add(o),this.queue.run()}},MartechAgentsManagerInternal}(),production_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},production_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(s){return function(c){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};!function(){production_awaiter(this,void 0,void 0,(function(){var t,e;return production_generator(this,(function(n){if(o!==i)return[2];if((t=window.MartechAgentsManager)instanceof F)return[2];if(window.MartechAgentsManager=new F,t instanceof Array)for(e=0;e<t.length;e++)window.MartechAgentsManager.push(t[e]);return[2]}))}))}()}();